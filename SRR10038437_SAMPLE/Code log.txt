#To reduce the sample size from ~10GB to ~1GB
seqtk sample -s100 /home/petitlunette/data/SRR10038437.fastq 0.125 > /home/petitlunette/data/SRR10038437_sampled.fastq
#To inc memory = swap space
cd /mnt/e/ #my external hard drive
sudo fallocate -l 16G swapfile
sudo chmod 600 swapfile
sudo mkswap swapfile
sudo swapon swapfile
#check it was created
free -h
#turn off when done before removing hard drive
# sudo swapoff swapfile
#check its active 
# sudo swapon --show
#run Nanoplot
NanoPlot --fastq $HOME/data/SRR10038437_sampled.fastq -o $HOME/data_output/Nanoplot/sampledtest --verbose
#run flye
flye --nano-hq /home/petitlunette/data/SRR10038437_sampled.fastq --out-dir /home/petitlunette/data_output/Flye/sampledtest/ --iterations 0 --meta --threads 1
#run medaka
source $HOME/medaka/bin/activate
medaka_consensus -i /home/petitlunette/data/SRR10038437_sampled.fastq -d $HOME/data_output/Flye/sampledtest/assembly.fasta -t 1 -o $HOME/data_output/Medaka/sampledtest
#medaka did not finish but i have half a file
#run metawrap
conda activate metawrap-env
nano config-metawrap #and the wrote this mw_path=/home/petitlunette/metaWRAP/bin/metawrap
export PATH=$HOME/metaWRAP/bin:$PATH
#metawrap dependencies cos it kept breaking
conda install -n metawrap-env bwa=0.7.15 samtools=1.3.1 metabat2=2.9.1 concoct=0.4.0 maxbin2=2.2.4 kraken=0.10.6 krona=2.7 spades=3.10.1 -c bioconda -c conda-forge
pip install checkm-genome==1.0.7
checkm data setRoot $HOME/metaWRAP/MY_CHECKM_FOLDER
conda install -n metawrap-env bwa=0.7.15 -c bioconda
conda install -n metawrap-env metabat2 -c bioconda
conda install -n metawrap-env concoct -c bioconda
conda install -n metawrap-env python=3.7 #concoct broke because it needed numpy
#this broke it again, so back to py 2.7 just not using --concoct
metawrap binning -o $HOME/data_output/metaWRAP/sampledtest -a $HOME/data_output/Medaka/sampledtest/consensus.fasta --metabat2 --maxbin2 --concoct --single-end $HOME/data/SRR10038437_sampled.fastq
#bin refinement wont work only had 2-3 bins
#using checkm for quality
conda install -c bioconda prodigal
prodigal -v
conda install -c bioconda pplacer
checkm lineage_wf -x fa /home/petitlunette/data_output/metaWRAP/sampledtest/metabat2_bins/ /home/petitlunette/data_output/checkm/sampledtest_metabat/
checkm lineage_wf -x fa /home/petitlunette/data_output/metaWRAP/sampledtest/maxbin2_bins/ /home/petitlunette/data_output/checkm/sampledtest_maxbin/
